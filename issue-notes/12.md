# issue project-summary を他projectから使いやすくする #12
[issues #12](https://github.com/cat2151/github-actions/issues/12)

- 課題、個別dirへの移動が必要。
    - scripts
    - prompts
        - さらに、呼び出し元ymlから任意のpromptsを指定できるようにする。
- 課題、これだと別project時に動かない。
    - 現在はたまたま共通ワークフローのリポジトリと呼び出し元ワークフローのリポジトリが同一のため、
    - 呼び出し元checkoutをするだけで、
    - 共通ワークフロー側のscriptファイルが取得できてしまっている
    - 対策
        - 他のyml同様、共通ワークフロー側のリポジトリをcheckoutする
- docs
    - call導入手順を書く
- 課題、promptを呼び出し元ymlから指定できるようにすべし。
    - 現在はscript内にファイル名決め打ちで存在しているため、他のprojectで別ymlを指定できない。
    - 方法、他のcallワークフローで指定しているところを参考にすべし

# 状況
- 上記のうち、別dirへの切り分け等は実施済みのはず
- どうする？
    - それをここに可視化する。

# 結果
- project summary で生成させたagent用promptを投げた
- 結果は以下

# Issue #12 現状分析・改修提案報告

## 1. 現状分析

### 1.1 個別ディレクトリへの移動
- `scripts`・`prompts`ディレクトリへの分離は既に実施済み。
  - `ProjectSummaryCoordinator.cjs` → `scripts/`
  - `development-status-prompt.md`・`project-overview-prompt.md` → `prompts/`

### 1.2 共通リポジトリの checkout
- 呼び出し元リポジトリと共通ワークフローリポジトリが同一の場合は問題なし。
- 他プロジェクトで利用する場合は、共通ワークフローリポジトリの checkout が必要。
  - `call-daily-project-summary.yml` などで `actions/checkout@v3` を使い、共通リポジトリを明示的に checkout する必要あり。

### 1.3 プロンプトの呼び出し元ymlから指定
- 現状は `ProjectSummaryCoordinator.cjs` 内でプロンプトファイル名が決め打ち。
- 呼び出し元ymlから任意のプロンプトを指定できない。
- `TMP_DIR`, `PROMPT_DIR` などの環境変数でパス管理しているが、プロンプトファイル名自体は外部から渡せない設計。

---

## 2. 残課題

- **プロンプトファイルの外部指定化**
  呼び出し元ymlからプロンプトファイル名（パス）を指定できるようにする必要がある。

---

## 3. 改修提案

### 3.1 変更方針

- `ProjectSummaryCoordinator.cjs` のプロンプトファイル名決め打ち部分を、環境変数（例: `PROMPT_FILE`）で外部指定できるように修正。
- `daily-project-summary.yml`・`call-daily-project-summary.yml` で `PROMPT_FILE` を環境変数として渡す。
- デフォルト値は維持しつつ、外部指定があればそれを優先。

### 3.2 具体的な変更内容

#### 1. `.github_automation/project_summary/scripts/ProjectSummaryCoordinator.cjs`
- プロンプトファイル名の決め打ちを廃止し、`process.env.PROMPT_FILE` で取得するように修正。
- 例:
  ```js
  // ...existing code...
  const promptFile = process.env.PROMPT_FILE || 'prompts/development-status-prompt.md';
  // ...existing code...
  ```

#### 2. `.github/workflows/daily-project-summary.yml`
#### 3. `.github/workflows/call-daily-project-summary.yml`
- `env` セクションに `PROMPT_FILE` を追加し、必要に応じて値を指定。
- 例:
  ```yaml
  env:
    TMP_DIR: ${{ github.workspace }}/tmp
    PROMPT_DIR: ${{ github.workspace }}/.github_automation/project_summary/prompts
    PROMPT_FILE: ${{ env.PROMPT_DIR }}/development-status-prompt.md
  ```

#### 4. 呼び出し元ymlで任意のプロンプトを指定したい場合
- `PROMPT_FILE` の値を変更するだけで、他のプロンプトファイルを利用可能。

### 3.3 変更のメリット・デメリット

| 項目 | メリット | デメリット |
|------|----------|------------|
| プロンプト外部指定 | 他プロジェクト・他ymlから柔軟にプロンプトを指定可能 | 呼び出し元ymlの記述がやや複雑化 |
| パス管理 | 既存の `PROMPT_DIR` を活用できる | ディレクトリ構成変更時はymlも修正必要 |
| 汎用性 | ワークフローの再利用性向上 | 既存利用箇所の動作検証が必要 |

---

## 4. まとめ

- 個別ディレクトリ分離・共通リポジトリ checkout はほぼ解決済み。
- 残課題は「プロンプトファイルの外部指定化」。
- `PROMPT_FILE` 環境変数導入により、呼び出し元ymlから任意のプロンプトを指定可能となる。
- これにより、他プロジェクト・他ymlからの柔軟な利用が実現できる。

# どうする？
- 上記を1stepずつ進める
    - まずproject summaryに次の一手を生成させる
